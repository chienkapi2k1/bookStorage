@using BookSto.Models;
@model List<Thung>
@{
    ViewBag.Title = "PhanLoaiSach";
    Layout = "~/Views/Shared/_Layout_Admin.cshtml";
    List<theloai> lst_tl = TempData["lst_tl"] as List<theloai>;
    List<tacgia> lst_tg = TempData["lst_tg"] as List<tacgia>;
    TempData.Keep("lst_tl");
    TempData.Keep("lst_tg");
    string tensach = "";
    if(TempData["tensach"] != null)
    {
        tensach = TempData["tensach"].ToString();
    }
    int? matheloai = TempData["matheloai"] as int?;
    int? matacgia = TempData["matacgia"] as int?;
    List<Thung> lst_thung0 = TempData["lst_thung0"] as List<Thung>;
    TempData.Keep("lst_thung0");
}

<!-- Page Content  -->
<div id="content-page" class="content-page">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <div class="iq-card-transparent mb-0">
                    <div class="d-block text-center">
                        <h2 class="mb-3">Tìm kiếm trong kho</h2>
                        <div class="w-100 iq-search-filter">
                            <form action="" class="searchbox" >
                                <ul class="list-inline p-0 m-0 row justify-content-center search-menu-options">
                                    <li class="search-menu-opt">
                                        <div class="iq-dropdown">
                                            <div class="form-group mb-0">
                                                <select name="matheloai" class="form-control form-search-control bg-white border-0" id="exampleFormControlSelect2">
                                                    <option value="">Thể loại</option>
                                                    @foreach (theloai tl in lst_tl)
                                                    {
                                                        if (matheloai == tl.MaTheLoai)
                                                        {
                                                            <option selected value="@tl.MaTheLoai">@tl.TenTheLoai</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@tl.MaTheLoai">@tl.TenTheLoai</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="search-menu-opt">
                                        <div class="iq-dropdown">
                                            <div class="form-group mb-0">
                                                <select name="matacgia" class="form-control form-search-control bg-white border-0" id="exampleFormControlSelect4">
                                                    <option value="">Tác giả</option>
                                                    @foreach (tacgia tl in lst_tg)
                                                    {
                                                        if (matacgia == tl.MaTacGia)
                                                        {
                                                            <option selected value="@tl.MaTacGia">@tl.TenTacGia</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@tl.MaTacGia">@tl.TenTacGia</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="search-menu-opt">
                                        <div class="iq-search-bar search-book d-flex align-items-center">
                                            <input type="text" value="@tensach" id="tensach" name="tensach" class="text search-input" placeholder="tìm tên sách...">
                                            <a class="search-link" href="#"><i class="ri-search-line"></i></a>
                                            <button type="submit" class="btn btn-primary search-data ml-2">Tìm</button>
                                        </div>
                                    </li>
                                </ul>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="iq-card">
                    <div class="iq-card-body">
                        <div class="row">
                            @if (Model != null)
                            {
                                foreach (Thung s in Model)
                                {
                                    <div class="col-sm-6 col-md-4 col-lg-3">
                                        <div class="iq-card iq-card-block iq-card-stretch iq-card-height browse-bookcontent">
                                            <div class="iq-card-body p-0">
                                                <div class="d-flex align-items-center">
                                                    <div class="col-6 p-0 position-relative image-overlap-shadow shadow">
                                                        <a href="javascript:void();"><img class="img-fluid rounded w-100" src="~/assets/book_images/@s.Anh" alt=""></a>
                                                        <div class="view-book">
                                                            <a href="@Url.Action("ChiTietSach", "Sach", new { @MaThung = s.MaThung, @MaSach = s.MaSach })" class="btn btn-sm btn-white">Xem chi tiết</a>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="mb-2">
                                                            <h6 class="mb-1">@s.TenSach</h6>
                                                            <p class="font-size-13 line-height mb-1">@s.TacGia</p>
                                                            <p class="font-size-13 line-height mb-1">@s.Sach.theloai.TenTheLoai</p>
                                                            <p class="font-size-13 line-height mb-1">@s.TongSoThung thùng có sẵn</p>
                                                            <p class="font-size-13 line-height mb-1">@s.SoSachTrongThung quyển/thùng</p>
                                                        </div>
                                                        @if (s.GiamGia != 0)
                                                        {
                                                            <div class="price d-flex align-items-center">
                                                                <span class="pr-1 old-price font-size-11">@String.Format("{0:N0}", s.Gia) ₫<br></span>
                                                            </div>
                                                            <div class="price d-flex align-items-center">
                                                                <h6><b>@String.Format("{0:N0}", s.Gia - s.Gia * s.GiamGia / 100) ₫</b></h6>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div class="price d-flex align-items-center">
                                                                <h6><b>@String.Format("{0:N0}", s.Gia) ₫</b></h6>
                                                            </div>
                                                        }
                                                        <div class="iq-product-action">
                                                            <a href="@Url.Action("ThemSach_GioHang","Sach", new{@MaThung = s.MaThung , @Url = Request.Url.ToString()})"><i class="ri-shopping-cart-2-fill text-primary"></i></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="iq-card iq-card-block iq-card-stretch iq-card-height">
                    <div class="iq-card-header d-flex justify-content-between align-items-center position-relative mb-0 similar-detail">
                        <div class="iq-header-title">
                            <h4 class="card-title mb-0">Hết hàng</h4>
                        </div>
                    </div>
                    <div class="iq-card-body similar-contens">
                        <ul id="similar-slider" class="list-inline p-0 mb-0 row">
                            @if (lst_thung0 != null)
                            {
                                foreach (Thung s in lst_thung0)
                                {
                                    <li class="col-md-3 col-sm-6 col-lg-3">
                                        <div class="d-flex align-items-center">
                                            <div class="col-5 p-0 position-relative image-overlap-shadow">
                                                <a href="javascript:void();"><img class="img-fluid rounded w-100" src="~/assets/book_images/@s.Anh" alt=""></a>
                                                <div class="view-book">
                                                    <a href="@Url.Action("ChiTietSach", "Sach", new { @MaThung = s.MaThung, @MaSach = s.Sach.MaSach })" class="btn btn-sm btn-white">Xem chi tiết</a>
                                                </div>
                                            </div>
                                            <div class="col-7">
                                                <div class="mb-2">
                                                    <h6 class="mb-1">@s.TenSach</h6>
                                                    <p class="font-size-13 line-height mb-1">@s.TacGia</p>
                                                    <p class="font-size-13 line-height mb-1">@s.Sach.theloai.TenTheLoai</p>
                                                    <p class="font-size-13 line-height mb-1">@s.TongSoThung thùng có sẵn</p>
                                                    <p class="font-size-13 line-height mb-1">@s.SoSachTrongThung quyển/thùng</p>
                                                </div>
                                                @if (s.GiamGia != 0)
                                                {
                                                    <div class="price d-flex align-items-center">
                                                        <span class="pr-1 old-price font-size-11">@String.Format("{0:N0}", s.Gia) ₫<br></span>
                                                    </div>
                                                    <div class="price d-flex align-items-center">
                                                        <h6><b>@String.Format("{0:N0}", s.Gia - s.Gia * s.GiamGia / 100) ₫</b></h6>
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="price d-flex align-items-center">
                                                        <h6><b>@String.Format("{0:N0}", s.Gia) ₫</b></h6>
                                                    </div>
                                                }
                                                <div class="iq-product-action"></div>
                                            </div>
                                        </div>
                                    </li>
                                }
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
